const form=document.querySelector(".form"),btnSubmit=document.querySelector(".feedback__btn"),feedbackRight=document.querySelector(".feedback__right"),templateFeedbackErrorMessage=document.querySelector("#feedback-error-message"),templateFeedbackSuccessMessage=document.querySelector("#feedback-success-message");if(form&&btnSubmit&&feedbackRight&&templateFeedbackErrorMessage&&templateFeedbackSuccessMessage){const e=form.querySelector("#form__name"),t=form.querySelector("#form__email"),a=feedbackRight.querySelector(".feedback__message");function email_test(e){return!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(e.value)}function name_test(e){return!/^[a-zA-Zа-яА-Я -]+$/i.test(e.value)}function validate_input(e,t="",a=!0){a?e.parentNode.classList.add(t):e.parentNode.classList.remove(t)}e.addEventListener("focusout",(()=>{validate_input(e,"error1",name_test(e))})),e.addEventListener("focus",(()=>{e.parentNode.classList.remove("error1")})),t.addEventListener("focusout",(()=>{validate_input(t,"error2",email_test(t))})),t.addEventListener("focus",(()=>{t.parentNode.classList.remove("error2")}));const s=(e=!0,t="")=>{if(feedbackRight.classList.add("hide"),a.classList.add("active"),t.length>0)a.innerHTML=t;else{let t;t=e?templateFeedbackErrorMessage.content.cloneNode(!0):templateFeedbackSuccessMessage.content.cloneNode(!0),a.innerHTML="",a.appendChild(t)}btnSubmit.querySelectorAll("span").forEach((e=>e.textContent=e.dataset.sendAgain??"")),form.dataset.full=1},r=e=>{const t=design_ajax.url??"";try{fetch(t,{method:"POST",credentials:"same-origin",body:e}).then((e=>e.json())).then((e=>{!0===e.success?(s(!1),console.log("Успех:",e)):(s(),console.error("Ошибка:",e))})).catch((e=>{s(),console.error("Ошибка:",e)}))}catch(e){s(),console.error("Ошибка:",e)}};btnSubmit.addEventListener("click",(function(s){if(0==form.dataset.full)if(name_test(e)||email_test(t))validate_input(e,"error1",name_test(e)),validate_input(t,"error2",email_test(t));else{const e=new FormData(form);e.append("action","design_sendmail"),e.append("security",design_ajax.nonce);let t=0;const a=design_ajax.site_key??!1;a&&grecaptcha?grecaptcha.ready((function(){grecaptcha.execute(a,{action:"submit"}).then((function(a){t=1,e.append("antibot",t),r(e)}))})):(t=1,e.append("antibot",t),r(e))}else form.reset(),feedbackRight.classList.remove("hide"),a.classList.remove("active"),btnSubmit.querySelectorAll("span").forEach((e=>e.textContent=e.dataset.sendIt??"")),form.dataset.full=0}))}